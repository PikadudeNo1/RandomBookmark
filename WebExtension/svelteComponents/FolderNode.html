<li class="folderNode" ref:elem
	role="treeitem" aria-expanded="{list.length ? showSubfolders : 'undefined'}">
	<div class="selIndicator" tabindex="{selected ? 0 : -1}" ref:focusMe
		 on:focus="set({showKeyHelp: true})" on:blur="set({showKeyHelp: false})"/>
	{#if list.length}
		<button type="button" tabindex="-1" class="expander {showSubfolders ? 'expanded' : ''}"
			on:click="set({showSubfolders: !showSubfolders})"></button>
	{/if}
	<button type="button" tabindex="-1" class="folderName" disabled="{!enabled}"
		on:click="$onChosen({id, andSubfolders: searchSubfolders})">{title}</button>
	{#if list.length && $showAndSubfolders}
		<button type="button" tabindex="-1" class="andSubfolders" disabled="{!hasDescendantBookmarks}"
			on:click="$onChosen({id, andSubfolders: true})">
			{$l10nCached.andSubfolders}
			{#if showKeyHelp}
				<span class="keyboardHelp">{$l10n("ctrlEnter")}</span>
			{/if}
		</button>
	{/if}
	<button type="button" tabindex="-1" class="pin {pinned ? 'pinned' : ''}"
		aria-label="{$l10nCached.pin}" aria-pressed="{pinned}"
		on:click="$onTogglePin(id, !pinned)">
		{#if showKeyHelp}
			<span class="keyboardHelp">ctrl+P</span>
		{/if}
	</button>
	{#if showSubfolders}
		<ul class="subfolders" role="group">
			<FolderNodeList {list} {autoOpen}/>
		</ul>
	{/if}
</li>
<script>
import FolderNodeList from "./FolderNodeList.html";
export default {
	setup(FolderNode) {
		FolderNode.cacheL10n = ["andSubfolders", "pin"];
	},
	data() {
		return {
			showSubfolders: false,
			selected: false,
		};
	},
	oncreate() {
		this.refs.elem.component = this;
		var {autoOpen} = this.get();
		if (autoOpen && autoOpen.has(this.get().id)) {
			this.expandIfExpandable();
			autoOpen.delete(this.get().id);
		}
	},
	methods: {
		expandIfExpandable() {
			if (this.get().list.length) {
				this.set({showSubfolders: true});
			}
		}
	},
	computed: {
		searchSubfolders: ({ $searchIn }) => { return $searchIn == "folderAndSubfolders"; },
		enabled: ({ searchSubfolders, hasChildBookmarks, hasDescendantBookmarks }) => {
			return searchSubfolders ? hasDescendantBookmarks : hasChildBookmarks;
		},
		pinned: ({ $pins, id }) => { return $pins.has(id); },
	},
	components: { FolderNodeList }
};
</script>